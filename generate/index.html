<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="src/styles/default.css" />
    <title>Todos</title>
</head>
<body class="hover">

<div class="main-wrapper">
    <div class="todos-header">
        <h1 class="todos-title">Todos</h1>
    </div>

    <div class="todos-main ">

        <div class="todos-add">
            <div class="action todo-add_select-all-action">
                <div class="action_visual"></div>
                <button class="action_target j  s-todos-select-all" aria-label="Отметить все как выполненные"></button>
            </div>

            <div class="todo-add_input-w">
                <input class="todo-add_input" placeholder="Добавить"
                       aria-label="Поле добавления todo" />
            </div>
        </div>

        <div class="todos-list"></div>

        <div class="todos-actions-bar">

            <div class="todos-actions-bar_counter"
                 aria-label="Количество не сделанных todo">
                2 задачи
            </div>

            <button class="todos-actions-bar_clear-completed">Удалить завершённые</button>

            <div class="todos-filters">
                <button class="filter all __active" data-filter="all"
                        aria-label="Фильтр: показать все">Все</button><!--
                --><button class="filter ready" data-filter="unready"
                           aria-label="Фильтр: показать невыполненные">Невыполненные</button><!--
                --><button class="filter unready" data-filter="ready"
                           aria-label="Фильтр: показать выполненные">Выполненные</button>
            </div>

        </div>

    </div>
</div>
<script>
    var countTodos=0;

    inputHandler();
    deleteHandler();
    checkboxHandler();
    selectAllHandler();
    switchCategoryHandler();
    deleteDoneHandler();

    function inputHandler() {
        var input = document.getElementsByClassName("todo-add_input")[0];
        input.addEventListener("keydown", function (event) {
            if (event.keyCode===13) {
                todoOn();
                todoItem(input.value);
                clearInputField();
            }
        });

        //Отобразить Action-bar
        var todoOn = function() {
            var main = document.getElementsByClassName("todos-main")[0]     ;
            main.classList.add("__has-todos");
        };

        //Очистить поле ввода
        var clearInputField = function () {
            input.value="";
        };

        //Создать todoItem
        var todoItem = function(value) {
            var todoList = document.getElementsByClassName("todos-list")[0];
            var todoItem = document.createElement("div");
            todoItem.classList.add('todo-item');
            todoItem.innerHTML = "<div class='input-checkbox'> <input type='checkbox' class='input-checkbox_target' aria-label='Пометить как невыполненное'> <div class='input-checkbox_visual'> <div class='input-checkbox_visual_icon'></div> </div> </div> <div class='action todo-item_remove-action'> <div class='action_visual'></div> <button class='action_target remove_item' aria-label='Удалить todo'></button> </div> <div class='todo-item_text-w'> <div class='todo-item_text' contenteditable='true'>"+value+"</div> </div>";
            todoList.appendChild(todoItem);
            incrementCounter();
        }
    }

    function deleteHandler() {
        document.addEventListener("click", function () {
            var currentItem = event.target;
            if (currentItem.classList.contains("remove_item")) {
                currentItem.parentNode.parentNode.outerHTML="";
            }
        });
    }

    function checkboxHandler() {
        document.addEventListener("click", function () {
            var currentCheckbox = event.target;
            var currentItem = currentCheckbox.parentNode.parentNode;
            if(currentCheckbox.classList.contains("input-checkbox_target")) {
                if (currentItem.classList.contains("__ready")) {
                    currentItem.classList.remove("__ready");
                } else {
                    currentItem.classList.add("__ready");
                }
            }
        })
    }

    function selectAllHandler() {
        var isClicked = false;
        document.addEventListener("click", function () {
            if (event.target.classList.contains("s-todos-select-all")) {
                var items = document.getElementsByClassName("todo-item");
                var checkboxes = document.getElementsByClassName("input-checkbox_target");
                if(isClicked===false) {
                    for (var i=0; i<items.length; i++) {
                        checkboxes[i].checked=true;
                        items[i].classList.add("__ready");
                    }
                    isClicked=true;
                } else {
                    for (var i=0; i<items.length; i++) {
                        checkboxes[i].checked=false;
                        items[i].classList.remove("__ready");
                    }
                    isClicked=false;
                }
            }

        })
    }
    
    function switchCategoryHandler() {
        document.addEventListener("click", function () {
            var current = event.target;
            if (current.classList.contains("all")) {
                allItems(current);
            } else if (current.classList.contains("ready")) {
                readyItems(current);
            } else if(current.classList.contains("unready")) {
                unreadyItems(current);
            }
        });

        var allItems = function (item) {
            changeOnActive(item);
            showAll();
        };

        var readyItems = function (item) {
            changeOnActive(item);
            hideUnready();
        };

        var unreadyItems = function (item) {
            changeOnActive(item);
            hideReady();
        };

        var showAll = function() {
            var elements = document.getElementsByClassName("todo-item");
            for (var i=0; i<elements.length; i++) {
                elements[i].classList.remove("__hide");
            }
        };

        var hideUnready = function() {
            var elements = document.getElementsByClassName("todo-item");
            for (var i=0; i<elements.length; i++) {
                if (elements[i].classList.contains("__ready")) {
                    elements[i].classList.add("__hide");
                } else {
                    elements[i].classList.remove("__hide");
                }
            }
        };

        var hideReady = function() {
            var elements = document.getElementsByClassName("todo-item");
            for (var i=0; i<elements.length; i++) {
                if (!elements[i].classList.contains("__ready")) {
                    elements[i].classList.add("__hide");
                } else {
                    elements[i].classList.remove("__hide");
                }
            }
        };

        var changeOnActive = function (item) {
            var elements = document.getElementsByClassName("filter");
            for (var i=0; i<elements.length; i++){
                elements[i].classList.remove("__active");
            }
            item.classList.add("__active");
        }
    }

    function deleteDoneHandler() {
        document.addEventListener("click", function () {
            if (event.target.className==="todos-actions-bar_clear-completed") {
                var elements = document.getElementsByClassName("todo-item");
                var length = elements.length;
                for (var i = 0; i < length;) {
                    if (elements[i].classList.contains("__ready")) {
                        elements[i].parentNode.removeChild(elements[i]);
                        decrementCounter();
                    } else {
                        i++;
                    }
                }

            }
        });
    }

    function incrementCounter() {
        countTodos++;
        showCounter();
    }
    function decrementCounter() {
        countTodos--;
        showCounter();
    }

    function showCounter() {
        var element = document.getElementsByClassName("todos-actions-bar_counter");
        if (countTodos === 1) {
            element[0].innerText = countTodos + " задача";
        } else if (countTodos >= 1 && countTodos <= 4) {
            element[0].innerText = countTodos + " задачи"
        } else {
            element[0].innerText = countTodos + " задач";
        }
    }

</script>
</body>
</html>